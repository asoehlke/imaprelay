# imaprelay

Forwarding mails can cause some spam related issues. *imaprelay* uses three approaches: 
1. forward using the original sender 
2. If that is rejected, replace the sender email address with the "from" address in the configuration.
3. If the previous approaches fail, move the mail to the "error" folder and just send a notification email to the recipient.

## Configuration

All values set to null in the configuration template have to be set.
* IMAP and SMTP "hostname": just the name of the servers, e.g. "imap.myprovider.com". Currently, SSL connections to standard port will be used. Adding further options can be done if someone needs it.
* "from": any email address, can be the address of the mail box. 
* "sender": should be the email address of the mail box. Other address might be possible, but might be rejected by your SMTP server.
* "recipients": Filters are processed in the configured order, each mail is forwarded to the first matching entry.
    * "name" is just used for logging. 
    * The recipient "filter" can use the criteria listed here: https://pypi.org/project/imap-tools/#search-criteria.
      Only single key searches are supported. Used e.g. "TO andreas" to match all mails sent to addresses containing the string andreas in the recipient address. "github.andreas@my-server.de" would match.
      "ALL" matches all mails, useful to forward mails that do not match previous filters.
    * "to" is the email address matching mails are sent to. 

## Stand-alone Usage
This program will look for a configuration file ./data/options.json. It needs to contain plain-text passwords for IMAP and SMTP servers, 
and thus the program will exit immediately if the file is group- or world-readable.

As Home Assistant add-on, this file is generated by the Home Assistant configuration.
The structure is documented in the "options" and "schema" entries in config.json.

